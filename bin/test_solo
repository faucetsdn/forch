#!/bin/bash

source bin/stack_functions

preamble_setup

export CONTROLLER_NAME=127.0.0.1


echo Setting up OVS...
add_br sw1 0x12345 6653
add_faux sw1 2 1
add_faux sw1 4 2

sleep 5

docker exec forch-faux-1 ping -c 5 192.168.1.2 2>&1 | grep -oE "[0-9] received" | tee -a $TEST_RESULTS

# echo "Setting and testing Faucet version"
# sed -i 's/UNDEFINED/test/g' forch/__version__.py
# bin/forch --version | grep "Forch" | tee -a $TEST_RESULTS

echo "Setting up Faucet and Forch..."
bin/setup_solo

VERSION=$(bin/forch --version | grep Forch | awk '{print $2}')
VARZ_VERSION=$(wget 0.0.0.0:8302 -O- | grep forch_version_info | grep 1.0 | cut -d "\"" -f2 | cut -d "\"" -f1 )
echo $VERSION
echo $VARZ_VERSION

sleep 20

docker exec forch-faux-1 ping -c 5 192.168.1.2 2>&1 | grep -oE "[0-9] received" | tee -a $TEST_RESULTS
